# Product Recommendation by Customer Segmentation
## Online Retail dataset: 
https://archive.ics.uci.edu/dataset/352/online+retail
## Abstract
In the landscape of online retail, understanding customer behaviour and preferences is paramount for effective marketing strategies and enhanced sales. Segmentation of customers based on transactional and behavioural similarity between each other is very much helpful in the Online Retail field. It gives a thorough understanding of the way customers belonging to a particular segment spend their money and what kind of products they prefer to buy by analysing the spending pattern of other customers in that segment or cluster. This project aims to connect data analysis with marketing strategies, giving retailers the tools to improve how they reach customers and grow their business in the constantly changing online market. Our primary objective is to transform a raw transactional data that is collected from a retailer, and available online, into a customer-centric dataset favourable to segmentation analysis. This involves data cleaning procedures to handle missing values, duplicates, and outliers, ensuring the integrity and reliability of our dataset. Further, we engage in feature engineering process to generate new variables, based on the RFM (Recency, Frequency, Monetary), model that encapsulate crucial aspects of customer behaviour and transaction history. Then we employ the K-means clustering algorithm and partition the customers into distinct clusters based on the features in the Customer centric data built from the initial transactions data. We then evaluate the clusters (segments) through the k – means cluster evaluation metrics and proceed to the next step of building a recommendation system to enhance cross-selling opportunities and boost sales. The recommendation system uses cluster-specific product recommendations, suggesting top-selling items to customers within each segment who have yet to make corresponding purchases. This personalized approach aims to increase marketing effectiveness by presenting customers with products aligned with their preferences and purchase history, thereby increasing sales and customer loyalty. This project emphasizes the importance of customer segmentation in the field of online retail by recommending products bought by the customers of their segment and thus helping increase the customer satisfaction and sales. Through the integration of advanced analytics techniques and machine learning algorithms we contribute to enhancing customer experiences and sustainable business growth. 

## 1. Introduction

In the dynamic landscape of online retail, understanding customer behaviour and preferences is paramount for devising effective marketing strategies and driving sales growth. Marketers increasingly recognize the importance of customer segmentation as a strategic tool for enhancing customer service and maximizing business value. By dividing customers into distinct groups based on shared characteristics and behaviours, marketers can tailor their offerings and communication strategies to meet the specific needs of each segment, thereby fostering enhanced customer engagement and loyalty. Customer segmentation studies involve the comprehensive analysis of customer data, encompassing demographic information, purchasing patterns, and other relevant metrics. By leveraging advanced analytics techniques, marketers can derive actionable insights from vast datasets, enabling the identification of homogeneous customer groups with distinct preferences and behaviours. This segmentation analysis lays the foundation for targeted marketing initiatives, allowing marketers to allocate resources more efficiently and drive personalized interactions with customers. 

### 1.1 Customer Behaviour and Features 

One critical aspect of customer segmentation is the consideration of customer lifetime value (CLV), which reflects the potential long-term revenue or profit generated by a customer over their entire relationship with a business. By segmenting customers based on the features that determine CLV, marketers can prioritize resources and tailor marketing strategies to maximize the value derived from each customer interaction. This "action-centric" segmentation approach shifts the focus from immediate transactional outcomes to long-term customer relationships, thereby optimizing marketing effectiveness and driving sustained business growth.  

Another vital aspect in understanding customer behaviour and optimizing segmentation strategies involves the RFM model, an effective tool used by marketers to analyse and categorize customers based on three key metrics: recency, frequency, and monetary value. Recency refers to how recently a customer has made a purchase, highlighting their engagement and interaction with the brand. Frequency assesses how often a customer makes purchases, indicating their level of loyalty and propensity for repeat business. Monetary value quantifies the amount of money a customer spends, providing insights into their purchasing power and potential profitability. By examining these dimensions of customer activity, marketers gain a nuanced understanding of individual behaviours and preferences, allowing for targeted and personalized marketing efforts. Integrating the RFM model into segmentation analyses enhances the granularity of customer profiling, enabling marketers to identify high-value segments and tailor strategies to effectively engage and retain these valuable customer segments. This refined approach not only optimizes short-term transactional outcomes but also nurtures long-term customer relationships, driving sustained business growth and profitability. 

### 1.2 Customer Segmentation 

Various methodologies exist for customer segmentation, each offering unique insights into consumer behaviour and preferences. While traditional demographic segmentation remains a foundational approach, more advanced techniques have emerged, including clustering algorithms powered by machine learning. Among these, hierarchical clustering and K-means clustering stand out as prominent examples of unsupervised learning algorithms widely employed for customer segmentation tasks. Hierarchical clustering arranges customers into a hierarchical tree-like structure, where clusters at higher levels encompass broader similarities, while those at lower levels represent more granular distinctions. In contrast, K-means clustering partitions customers into distinct clusters based on similarities in their purchasing behaviour and preferences. This algorithm iteratively assigns data points to clusters and optimizes cluster centroids to maximize within-cluster similarity and minimize between-cluster variance. The K-means algorithm's appeal lies in its scalability and computational efficiency, making it well-suited for handling the vast datasets characteristic of e-commerce applications. Moreover, its ability to generate meaningful segmentation results enables marketers to derive actionable insights for crafting targeted marketing strategies and personalized product recommendations tailored to specific customer groups. Through the application of K-means clustering and similar techniques, marketers can unlock deeper insights into consumer behaviour, fostering enhanced engagement and driving business growth in the competitive landscape of online retail. 

### 1.3 Product Recommendation system 

Product recommendation systems are integral components of modern e-commerce platforms, revolutionizing the customer shopping experience by delivering personalized product suggestions aligned with individual preferences and past purchasing behaviour. These systems utilize sophisticated algorithms that analyse vast amounts of customer data, including browsing history, purchase patterns, and demographic information, to generate tailored recommendations tailored to each user's unique preferences and interests. By leveraging insights derived from customer segmentation analyses, recommendation systems can further enhance their effectiveness by customizing product suggestions to align with the preferences of specific customer segments. Through clustering customers into distinct groups based on shared characteristics and behaviours, marketers gain valuable insights into the types of products that resonate most with each segment. By identifying popular products among customers within each cluster, recommendation systems can intelligently suggest similar items to other customers in the same segment, maximizing cross-selling opportunities and driving incremental sales growth. Moreover, recommendation systems continuously refine their algorithms through machine learning techniques, enabling them to adapt to evolving customer preferences and market trends over time. As a result, these systems not only enhance the customer shopping experience but also contribute significantly to revenue generation and customer satisfaction in the competitive landscape of online retail. 

In this project, we aim to leverage customer segmentation techniques, particularly K-means clustering. By clustering customers into distinct groups based on their purchasing behaviour, we intend to identify common preferences and characteristics within each segment. Subsequently, we will develop a product recommendation system that suggests top-selling products to customers within each segment who have not yet made corresponding purchases. Through this approach, we aim to enhance marketing effectiveness, drive sales growth, and foster increased customer satisfaction in the competitive landscape of online retail.

## 2. Methodology and Discussion 
### 2.1. Dataset Description 
We embark on a comprehensive analysis of a transactional dataset obtained from a reputable UK-based retailer, sourced from the UCI Machine Learning Repository, documents all transactions between the years 2010 and 2011.
The dataset comprises 541,909 entries meticulously curated across 8 columns.

| Variable    | Description                                                                                           |
|-------------|-------------------------------------------------------------------------------------------------------|
| **InvoiceNo**  | A 6-digit code representing each unique transaction. If this code starts with the letter 'C', it indicates a cancellation. |
| **StockCode**  | A 5-character code uniquely assigned to each distinct product.                                      |
| **Description** | Name/Description of each product.                                                                 |
| **Quantity**   | The number of units of a product in a transaction.                                                 |
| **InvoiceDate** | The date and time of the transaction.                                                             |
| **UnitPrice**  | The unit price of the product in sterling.                                                         |
| **CustomerID** | Identifier uniquely assigned to each customer.                                                     |
| **Country**    | The country of the customer.                                                                       |

### 2.2 Libraries Imported 
Several essential libraries are imported to facilitate data manipulation, analysis, and modelling. The imported libraries include NumPy, a fundamental package for numerical computations, providing support for array operations and mathematical functions. Additionally, the Pandas library is imported to handle structured data efficiently, allowing for data manipulation through data frames and series. Seaborn and Matplotlib are utilized for data visualization, offering a range of plotting functions to create informative and visually appealing graphs and charts. The Seaborn library, built on top of Matplotlib, provides a higher-level interface for statistical visualization, enhancing the aesthetics of plots and facilitating exploratory data analysis. Furthermore, the Scikit-learn library is imported to access the KMeans clustering algorithm and evaluate clustering performance using silhouette scores. KMeans from Scikit-learn enables the partitioning of customers into distinct segments based on their purchasing behaviour, a fundamental step in customer segmentation for targeted marketing strategies. Silhouette scores provide a measure of cluster cohesion and separation, aiding in the determination of the optimal number of clusters.  
By importing these libraries, the project is equipped with essential tools and functionalities for data preprocessing, clustering, and evaluation, laying the foundation for the development of an effective product recommendation system tailored to segmented customer groups. 

### 2.3 Exploratory Data Analysis 
Exploratory Data Analysis (EDA) serves as a fundamental step in the data analysis process, allowing researchers to gain insights, identify patterns, and formulate hypotheses before undertaking more advanced statistical modelling. It involves examining and visualizing data to understand its underlying structure, distribution, and relationships. EDA encompasses various techniques and approaches to uncovering hidden patterns and trends within datasets, offering valuable insights that inform subsequent analyses and decision-making processes. 

#### 2.3.1 Summary Statistics 
One essential aspect of EDA is summary statistics, which provide a concise overview of the dataset's central tendency, dispersion, and shape. Measures such as mean, median, and standard deviation offer insights into the dataset's distribution and variability, while quantiles and percentiles reveal its spread and skewness. These summary statistics help researchers understand the overall characteristics of the data and identify potential outliers or anomalies that may warrant further investigation.

Figure 1 Head of the transactional dataframe 

Figure 2 Descriptive statistics of Numerical columns 

Figure 3 Descriptive statistics of Categorical columns 

The summary statistics of the dataset unveil valuable insights into the characteristics and dynamics of the data. The average quantity of products per transaction stands at approximately 9.55, suggesting that customers typically purchase multiple items in a single transaction. However, the wide range of quantity values, spanning from -80995 to 80995, indicates the presence of returned or cancelled orders, necessitating appropriate handling to ensure data accuracy and integrity. The substantial standard deviation underscores the significant spread in the data, indicative of the presence of outliers that warrant further investigation and treatment.
Similarly, the average unit price of products is approximately 4.61, with a wide range extending from -11062.06 to 38970. The presence of negative prices is anomalous and likely indicative of errors or noise in the data. Moreover, the large disparity between the maximum and 75th percentile values suggest the presence of outliers, highlighting the need for careful scrutiny and potential removal to prevent undue influence on subsequent analyses. 
The CustomerID column exhibits 406829 non-null entries, signifying the presence of missing values that require attention. The range of Customer IDs from 12346 to 18287 enables the identification of unique customers, facilitating customer-centric analyses and segmentation strategies. The InvoiceNo column comprises 25900 unique invoice numbers, representing separate transactions. The prevalence of certain invoice numbers, such as 573585 occurring 1114 times, may indicate bulk transactions or orders encompassing multiple items. 
In terms of product representation, the dataset encompasses 4070 unique stock codes and 4223 unique product descriptions. The most frequent stock code, 85123A, appears 2313 times, while the most frequent product description, "WHITE HANGING HEART T-LIGHT HOLDER," occurs 2369 times. However, the presence of missing values in the Description column necessitates appropriate treatment to maintain data completeness and accuracy. 
Furthermore, transactions originate from 38 different countries, with the United Kingdom accounting for approximately 91.4% of the total transactions. This dominance underscores the importance of localization strategies tailored to the UK market while also highlighting the dataset's international scope and potential for cross-border analyses. Overall, these summary statistics provide a comprehensive overview of the dataset's characteristics, guiding further exploration and analysis to extract actionable insights and drive informed decision-making in the realm of online retail. 

#### 2.3.2 Visualization
Visualization techniques play a crucial role in EDA, enabling researchers to explore data through graphical representations that enhance understanding and interpretation. Common visualization tools include histograms, box plots, scatter plots, and density plots, each offering unique insights into different aspects of the data distribution and relationships between variables. Heatmaps and correlation matrices provide visualizations of pairwise relationships between variables, facilitating the identification of patterns and dependencies within the dataset.  
The following figures are such visualizations created for understanding the frequency distribution of the quantity column and the country wise sales distribution. 

Figure 4 Frequency distribution of Quantity column 

Figure 5 Country wise sales distribution

#### 2.3.3 Initial Data Cleaning and Preprocessing 
EDA also encompasses data cleaning and preprocessing steps to ensure the dataset's quality and integrity before analysis. This includes handling missing values, outliers, and inconsistencies, as well as transforming variables to meet modelling assumptions or address skewness and heteroscedasticity. Data normalization and standardization may also be performed to bring variables to a comparable scale and improve model performance.
In the initial stages of data preprocessing, it's imperative to address missing values and duplicates to ensure the integrity and reliability of subsequent analyses. Upon inspection, it was discovered that the dataset contains 1456 null values in the Description column and a substantial 135,080 null values in the CustomerID column, representing approximately 0.27% and 24.93% missing values, respectively. The CustomerID column, crucial for clustering customers and creating a recommendation system, exhibits a significant proportion of missing data, nearly a quarter of the column. Imputing such a large percentage of missing values could introduce considerable bias or noise into the analysis. Given the importance of accurate customer identifiers for clustering based on behaviour and preferences, the most prudent approach is to remove rows with missing CustomerIDs to maintain the integrity of the clusters and the subsequent analysis. Similarly, while the Description column has a minor percentage of missing values, inconsistencies in the data, where the same StockCode does not consistently correspond to the same Description, raise concerns about data quality and potential errors in product descriptions. Attempting to impute missing descriptions based on StockCode might not be reliable, particularly considering the low missing percentage. Thus, removing rows with missing Descriptions is advisable to prevent the propagation of errors and inconsistencies into subsequent analyses. Furthermore, the dataset contains 5225 duplicate rows, which, in the context of the project, are likely data recording errors rather than genuine repeated transactions. Retaining these completely identical duplicate rows can introduce noise and potential inaccuracies in clustering and recommendation systems. Thus, removing these duplicate rows is essential to achieve a cleaner dataset, facilitating more accurate customer clustering based on unique purchasing behaviours and enabling the creation of a more precise recommendation system by correctly identifying frequently purchased products. 
Upon handling null values and removing duplicates, the dataset is left with 401,604 rows, representing a substantial reduction from the initial dataset size. However, this reduction is essential for ensuring data integrity and reliability in subsequent analyses. By addressing missing values and duplicates upfront, we pave the way for more accurate and insightful analyses, ultimately leading to more effective decision-making in the realm of online retail. 
Further, after observing the statistical description of the UnitPrice column, it became evident that the minimum unit price value is zero. This observation suggests the presence of transactions where the unit price is recorded as zero, indicating either a free item or a potential data entry error. To gain deeper insights into the nature of these transactions, it is imperative to conduct a thorough investigation into the associated product descriptions to discern if they adhere to any discernible pattern. A closer examination reveals that transactions with a unit price of zero are relatively scarce, comprising only 33 transactions. Despite their limited occurrence, these transactions exhibit a wide variability in the quantity of items involved, ranging from 1 to 12,540, with a considerable standard deviation. Such variability underscores the potential impact of these transactions on the clustering analysis, as their inclusion could introduce noise and distort the customer behaviour patterns identified by the clustering algorithm.
In light of these findings, our strategy is to remove these transactions from the dataset. This approach aligns with the objective of maintaining a cleaner and more consistent dataset, essential for constructing an accurate and reliable clustering model and recommendation system. By excluding transactions with a unit price of zero, we mitigate the risk of introducing noise into the data analysis, thereby enhancing the robustness and interpretability of the clustering results. Furthermore, given the limited number of transactions affected and their potential to disrupt the integrity of the dataset, removing them is deemed the most prudent course of action. This strategic decision ensures that the clustering analysis is conducted on a more homogenous dataset, minimizing the likelihood of erroneous conclusions and facilitating the identification of meaningful customer segments based on genuine purchasing behaviours. Ultimately, by implementing this strategy, we aim to enhance the effectiveness and reliability of the subsequent clustering analysis, thereby laying the groundwork for the development of a more accurate and insightful recommendation system tailored to the diverse preferences of our customers in the online retail domain. 

### 2.4 Feature Engineering 
In the process of crafting a comprehensive customer-centric dataset useful to clustering and recommendation, we start on the journey of feature engineering, leveraging the available data to extract meaningful insights and enrich the analytical capabilities of our model. Our designated customer-centric dataframe, dubbed as 'customer_data', serves as the canvas upon which we paint a portrait of customer behaviour and preferences through the creation of essential features tailored to the complexities of the retail landscape.  Central to our feature engineering process is the integration of RFM (Recency, Frequency, Monetary) analysis, a tried-and-tested methodology for elucidating customer value and delineating the customer base into distinct segments. RFM encapsulates three fundamental dimensions of customer interaction, providing a holistic framework for understanding and segmenting customers based on their buying behaviour and preferences. 

Recency (R) is the first dimension we delve into, focusing on how recently a customer has made a purchase. This metric is pivotal in gauging the level of engagement and activity exhibited by each customer. To capture this, we engineer the "Days Since Last Purchase" feature. This feature quantifies the number of days elapsed since the customer's most recent purchase. A lower value indicates a more recent purchase, signifying heightened engagement with the brand. By understanding the recency of purchases, businesses can tailor their marketing strategies to re-engage customers who have not made recent purchases, thereby potentially boosting customer retention and fostering loyalty. 

Moving on to Frequency (F), we aim to quantify the extent of a customer's engagement with the retailer. To achieve this, we create two essential features: "Total Transactions" and "Total Products Purchased." The former represents the aggregate number of transactions conducted by each customer, offering insights into their overall engagement level. The latter indicates the total volume of products purchased by a customer across all transactions, providing valuable insights into their buying behaviour in terms of quantity. These features are instrumental in segmenting customers based on their frequency of engagement, a critical factor in devising targeted marketing strategies and personalized recommendations. 

Lastly, we address the Monetary (M) dimension by creating two pertinent features that encapsulate the monetary aspect of customer transactions. The first feature, "Total Spend," quantifies the total amount of money spent by each customer, calculated as the sum of the product of UnitPrice and Quantity for all transactions. This metric serves as a direct indicator of a customer's monetary value to the business. The second feature, "Average Transaction Value," is computed by dividing the Total Spend by the Total Transactions for each customer. This metric sheds light on the average value of a transaction carried out by a customer, offering insights into their spending behaviour per transaction. Such insights are invaluable in tailoring marketing strategies and offers to different customer segments based on their spending patterns. 

Through meticulous feature engineering encompassing the RFM framework, we equipped ourselves with a rich set of customer-centric features that form a base for effective clustering and recommendation systems in the dynamic landscape of online retail. These features not only enhance our understanding of customer behaviour and preferences but also empower us to deliver personalized experiences that drive customer satisfaction, loyalty, and ultimately, business growth.  

Apart from our efforts to engineer the RFM features, we further enhance our customer-centric dataset by incorporating additional dimensions that offer deeper insights into customer behaviour and preferences. These additional features not only enrich our understanding of customer dynamics but also empower us to craft more personalized marketing strategies and recommendations tailored to individual needs and preferences. Product Diversity emerges as a key aspect in understanding the varied purchasing behaviours of customers. By delving into the diversity of products purchased by each customer, we gain valuable insights into their preferences and tastes. To capture this aspect, we introduce the feature "Unique Products Purchased," which quantifies the number of distinct products bought by a customer. A higher value indicates a more diverse taste, with customers purchasing a wide range of products, while a lower value may signify a more focused or specific preference. Understanding the diversity in product purchases enables us to segment customers based on their buying diversity, thereby facilitating the creation of personalized product recommendations that resonate with their unique preferences. 

Moving on to Behavioural Features, we delve deeper into the temporal aspect of customer purchasing behaviour. One such feature, "Average Days Between Purchases," calculates the average number of days a customer waits before making another purchase. This metric provides valuable insights into customer buying patterns and can help predict when a customer is likely to make their next purchase. Such insights are instrumental in devising targeted marketing strategies and personalized promotions aimed at engaging customers at the right time with the right offers. Also the "Preferred_Day" and "Preferred_Hour" features provide insights into the customer's preferred or favourite shopping times, which can be useful in analysing behavioural similarity of customers.

Further, Cancellation Insights offer a window into customer dissatisfaction and potential issues that may affect their shopping experience. By analysing cancellation patterns, we gain valuable insights that can inform our customer segmentation model. Two key features introduced in this regard are "Cancellation Frequency" and "Cancellation Rate." The former quantifies the total number of transactions cancelled by a customer, offering insights into their cancellation behaviour. Understanding the frequency of cancellations helps identify customers who are more likely to cancel transactions, potentially indicating dissatisfaction or other issues. The latter feature, "Cancellation Rate," provides a normalized view of cancellation behaviour by representing the proportion of transactions cancelled out of all transactions. A high cancellation rate may signal an unsatisfied customer segment, warranting targeted strategies to improve their shopping experience and reduce cancellation rates. 

The ‘customer_data’ dataframe now comprises several engineered features aimed at providing a comprehensive understanding of customer behaviour and preferences. These features include CustomerID, Days Since Last Purchase, Total Transactions, Total Products Purchased, Total Spend, Average Transaction Value, Unique Products Purchased, Average Days Between Purchases, Cancellation Frequency, and Cancellation Rate. Each of these features offers unique insights into different aspects of customer interaction with the retailer, such as recency of purchases, frequency of transactions, monetary contribution, product diversity, purchase time behaviour, and cancellation behaviour. By leveraging these features, businesses can gain deeper insights into customer segments, enabling them to tailor marketing strategies and recommendations to better meet the needs and preferences of their diverse customer base. By incorporating the product diversity, behavioural features, cancellation insights into our dataset, we augment our understanding of customer behaviour, thereby facilitating the creation of more effective and nuanced customer segmentation. These insights enable us to identify distinct customer segments with unique needs and preferences, empowering us to tailor marketing strategies and recommendations that resonate with each segment, ultimately enhancing customer satisfaction and driving business growth. 

**Description of columns of customer_data**

| Variable                      | Description                                                                                                     |
|-------------------------------|-----------------------------------------------------------------------------------------------------------------|
| **CustomerID**                | Identifier uniquely assigned to each customer, used to distinguish individual customers.                        |
| **Days_Since_Last_Purchase**  | The number of days that have passed since the customer's last purchase.                                          |
| **Total_Transactions**        | The total number of transactions made by the customer.                                                          |
| **Total_Products_Purchased**  | The total quantity of products purchased by the customer across all transactions.                               |
| **Total_Spend**               | The total amount of money the customer has spent across all transactions.                                        |
| **Average_Transaction_Value** | The average value of the customer's transactions, calculated as total spend divided by the number of transactions. |
| **Unique_Products_Purchased** | The number of different products the customer has purchased.                                                    |
| **Average_Days_Between_Purchases** | The average number of days between consecutive purchases made by the customer.                                 |
| **Preferred_Day**             | The day of the week when the customer prefers to shop, represented numerically (0 for Monday, 6 for Sunday).     |
| **Preferred_Hour**            | The hour of the day when the customer prefers to shop, represented in a 24-hour format.                          |
| **Cancellation_Frequency**    | The total number of transactions that the customer has cancelled.                                               |
| **Cancellation_Rate**         | The proportion of transactions that the customer has cancelled, calculated as cancellation frequency divided by total transactions. |

